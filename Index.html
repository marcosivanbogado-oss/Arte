<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700;900&family=Cinzel:wght@400;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
  
  <style>
    /* --- TEMA: ROYAL MYSTIC (P√∫rpura Profundo & Oro) --- */
    :root {
      --bg-dark: #05000a;       /* Negro P√∫rpura */
      --card-bg: rgba(20, 0, 30, 0.9); /* Cristal Oscuro */
      --input-bg: #0f0217;      /* Input Profundo */
      --gold-main: #d4af37;     /* Oro Real */
      --gold-light: #ffeebb;    /* Oro Luz */
      --gold-shadow: #8a6e18;   /* Sombra Dorada */
      --beam-color: rgba(180, 80, 255, 0.15); /* Haz de luz */
      --text-main: #e0e0e0;
      --text-muted: #958aab;
    }

    body {
      margin: 0;
      background-color: var(--bg-dark);
      /* Fondo radial m√≠stico */
      background-image: radial-gradient(circle at 50% 0%, #2e003e 0%, var(--bg-dark) 85%);
      color: var(--text-main);
      font-family: 'Montserrat', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
      box-sizing: border-box;
      overflow-x: hidden;
    }

    /* --- CONTENEDOR PRINCIPAL --- */
    .app-frame {
      width: 100%;
      max-width: 550px;
      position: relative;
      border: 1px solid rgba(212, 175, 55, 0.2);
      border-radius: 20px;
      padding: 10px;
      background: rgba(10, 0, 20, 0.5);
      backdrop-filter: blur(10px);
      box-shadow: 0 0 60px rgba(0,0,0,0.9), inset 0 0 20px rgba(80, 0, 120, 0.2);
      overflow: hidden; /* Contiene el haz de luz */
      z-index: 1;
    }

    /* --- ANIMACI√ìN: HAZ DE LUZ (THE BEAM) --- */
    .light-beam {
      position: absolute;
      top: 0; left: -150%;
      width: 80%; height: 100%;
      background: linear-gradient(90deg, transparent 0%, var(--beam-color) 50%, transparent 100%);
      transform: skewX(-25deg);
      pointer-events: none;
      animation: shine 7s infinite ease-in-out;
      z-index: 2;
    }
    @keyframes shine {
      0% { left: -150%; opacity: 0; }
      20% { opacity: 1; }
      50% { left: 150%; opacity: 0; }
      100% { left: 150%; opacity: 0; }
    }

    /* --- CABECERA (JERARQU√çA INVERTIDA) --- */
    .header-section {
      text-align: center;
      padding: 25px 10px 35px 10px;
      position: relative;
      z-index: 3;
    }

    .flags-container { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; }
    .flag-icon {
      font-size: 1.6rem; cursor: pointer; opacity: 0.4; filter: grayscale(100%); transition: 0.4s;
      border-radius: 50%; padding: 2px; border: 2px solid transparent;
    }
    .flag-icon.active {
      opacity: 1; filter: grayscale(0%); transform: scale(1.2);
      border-color: var(--gold-main); box-shadow: 0 0 20px rgba(212,175,55,0.4);
    }

    /* T√çTULO PRINCIPAL (GRANDE) */
    .title-mystic {
      font-family: 'Cinzel', serif;
      font-size: 1.6rem; /* Tama√±o aumentado */
      color: #ffffff;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
      margin-bottom: 5px;
      line-height: 1.2;
    }

    /* SUBT√çTULO (VERSI√ìN PEQUE√ëA) */
    .title-bear {
      font-family: 'Cinzel Decorative', serif;
      font-size: 2.2rem; /* Tama√±o reducido */
      line-height: 1;
      background: linear-gradient(180deg, var(--gold-light) 10%, var(--gold-main) 60%, var(--gold-shadow) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 2px 0 rgba(0,0,0,0.8));
      margin: 0;
    }

    /* --- TARJETAS --- */
    .card-section {
      background-color: var(--card-bg);
      border-left: 4px solid var(--gold-main); /* Borde dorado izquierdo */
      border-radius: 8px;
      margin-bottom: 20px;
      padding: 22px;
      position: relative; z-index: 3;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }

    .card-title {
      font-family: 'Cinzel', serif; color: var(--gold-main);
      font-size: 0.95rem; font-weight: 700; margin-bottom: 18px;
      letter-spacing: 1px; text-transform: uppercase;
    }

    /* --- INPUTS --- */
    .input-group { margin-bottom: 15px; }
    .input-label {
      display: block; font-size: 0.75rem; color: var(--text-muted);
      margin-bottom: 7px; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase;
    }
    input, select {
      width: 100%; background: var(--input-bg);
      border: 1px solid #3a1550; border-radius: 8px;
      color: white; padding: 14px; font-size: 1rem;
      font-family: 'Montserrat', sans-serif;
      box-sizing: border-box; transition: 0.3s;
    }
    input:focus, select:focus {
      outline: none; border-color: var(--gold-main);
      box-shadow: 0 0 15px rgba(160, 30, 255, 0.3);
      background: #1a0526;
    }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }

    /* --- BOTONES DE ACCI√ìN --- */
    .footer-actions { display: flex; gap: 12px; margin: 25px 0; position: relative; z-index: 3; }
    
    .btn {
      flex: 1; padding: 16px; border-radius: 8px; font-size: 0.9rem;
      font-family: 'Cinzel', serif; font-weight: 700; cursor: pointer; border: none;
      transition: all 0.2s; text-transform: uppercase;
    }
    
    /* Reiniciar (Estilo Ghost/Glass) */
    .btn-reset {
      background: rgba(255,255,255,0.05); color: #aaa; border: 1px solid rgba(255,255,255,0.1);
    }
    .btn-reset:hover { background: rgba(255,255,255,0.1); color: #fff; border-color: #fff; }

    /* Calcular (Estilo Oro Real) */
    .btn-calc {
      background: linear-gradient(135deg, #ffd700 0%, #b8860b 100%);
      color: #1a0526;
      box-shadow: 0 5px 20px rgba(212,175,55,0.3);
    }
    .btn-calc:active { transform: scale(0.98); }

    /* --- BOT√ìN DE DONACI√ìN √âPICO --- */
    .epic-donate-btn {
      width: 100%; padding: 15px; background: transparent;
      border: 2px solid var(--gold-main); color: var(--gold-main);
      font-family: 'Cinzel', serif; font-weight: 800; cursor: pointer; border-radius: 8px;
      text-transform: uppercase; letter-spacing: 2px; position: relative; z-index: 3;
      display: flex; justify-content: center; align-items: center; gap: 10px;
      font-size: 0.95rem; transition: 0.3s; overflow: hidden;
    }
    /* Efecto brillo */
    .epic-donate-btn::after {
      content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    .epic-donate-btn:hover {
      background: rgba(212, 175, 55, 0.1);
      box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
    }
    .epic-donate-btn:hover::after { left: 100%; }

    /* --- RESULTADOS --- */
    #results { display: none; animation: slideUp 0.4s ease-out; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    
    .preset-display {
      background: #0f0217; border: 1px dashed var(--gold-main);
      padding: 18px; border-radius: 6px;
    }
    .res-row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; }
    .res-row:last-child { border-bottom: none; }
    .res-val { font-weight: 700; font-size: 1.2rem; }
    .c-inf { color: #999; } .c-lan { color: #9b59b6; } .c-mar { color: #f39c12; }
    
    .val-box { margin-top: 15px; font-size: 0.85rem; background: rgba(0,0,0,0.3); padding: 12px; border-radius: 6px;}
    .check-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
    .ok { color: #00ff9d; } .fail { color: #ff4444; }

    /* --- MODAL RADIANTE --- */
    .modal-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(5,0,10,0.95); z-index: 9999;
      justify-content: center; align-items: center;
      backdrop-filter: blur(8px);
    }
    .modal-content {
      background: linear-gradient(145deg, #1a0526, #0f0217);
      border: 2px solid var(--gold-main);
      padding: 35px 25px; width: 85%; max-width: 400px; text-align: center;
      border-radius: 16px; position: relative;
      box-shadow: 0 0 60px rgba(130, 0, 255, 0.3);
      animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .d-title-radiant {
      font-family: 'Cinzel Decorative', serif; color: var(--gold-main);
      font-size: 1.8rem; margin-bottom: 15px; line-height: 1.3;
      text-shadow: 0 0 20px rgba(212,175,55,0.6);
    }
    .d-text-joy {
      font-size: 1rem; color: #e0e0e0; margin-bottom: 30px; line-height: 1.6; font-style: italic;
    }
    
    .copy-box {
      background: #000; padding: 14px; border: 1px dashed var(--gold-main);
      color: var(--gold-light); font-family: monospace; cursor: pointer;
      margin-bottom: 20px; border-radius: 8px; font-size: 0.9rem;
      display: flex; justify-content: space-between; align-items: center;
    }
    .pp-btn {
      display: flex; justify-content: center; align-items: center; gap: 8px;
      background: linear-gradient(to right, #003087, #0050d0); color: white; padding: 15px;
      text-decoration: none; border-radius: 8px; font-weight: bold; font-family: 'Cinzel', serif;
      box-shadow: 0 5px 15px rgba(0, 48, 135, 0.5); transition: 0.2s;
    }
    .pp-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 48, 135, 0.7); }

    .close-modal-btn {
      margin-top: 25px; background: transparent; border: 1px solid rgba(255,255,255,0.3);
      color: #aaa; padding: 10px 25px; border-radius: 20px; cursor: pointer;
      transition: 0.3s; font-family: 'Cinzel';
    }
    .close-modal-btn:hover { border-color: white; color: white; }

  </style>
</head>
<body>

  <div class="app-frame">
    <div class="light-beam"></div>

    <div class="header-section">
      <div class="flags-container">
        <span class="flag-icon active" onclick="setLang('es', this)">üá™üá∏</span>
        <span class="flag-icon" onclick="setLang('en', this)">üá∫üá∏</span>
        <span class="flag-icon" onclick="setLang('it', this)">üáÆüáπ</span>
        <span class="flag-icon" onclick="setLang('pt', this)">üáßüá∑</span>
      </div>
      <div class="title-mystic">MYSTIC AND PROMETEO</div>
      <div class="title-bear">BEAR 2.0</div>
    </div>

    <div class="card-section">
      <div class="card-title" id="t_conf">DATOS DE BATALLA</div>
      <div class="input-group">
        <label class="input-label">üö© <span id="l_cap">CAPACIDAD</span></label>
        <input type="number" id="capacity" placeholder="Ej: 150000">
      </div>
      <div class="input-group">
        <label class="input-label">üë• <span id="l_mar">MARCHAS</span></label>
        <select id="march-count">
          <option value="1">1</option><option value="2">2</option><option value="3">3</option>
          <option value="4">4</option><option value="5">5</option><option value="6" selected>6</option><option value="7">7</option>
        </select>
      </div>
    </div>

    <div class="card-section">
      <div class="card-title" id="t_strat">CONF. TROPAS (%)</div>
      <div class="grid-3">
        <div class="input-group"><label class="input-label">üõ°Ô∏è <span id="l_inf">INF</span></label><input type="number" id="pct-inf" value="0"></div>
        <div class="input-group"><label class="input-label">‚öîÔ∏è <span id="l_lan">LAN</span></label><input type="number" id="pct-lan" value="20"></div>
        <div class="input-group"><label class="input-label">üèπ <span id="l_tir">TIR</span></label><input type="number" id="pct-mar" value="80"></div>
      </div>
    </div>

    <div class="card-section">
      <div class="card-title" id="t_inv">INVENTARIO (OPCIONAL)</div>
      <div class="grid-3">
        <div class="input-group"><input type="number" id="stock-inf" placeholder="Inf."></div>
        <div class="input-group"><input type="number" id="stock-lan" placeholder="Lan."></div>
        <div class="input-group"><input type="number" id="stock-mar" placeholder="Tir."></div>
      </div>
    </div>

    <div id="results" class="card-section" style="border-left-color: #00ff9d;">
      <div class="card-title" id="t_res">RESULTADO PREDEFINIDO</div>
      <div class="preset-display">
        <div class="res-row"><span class="c-inf">üõ°Ô∏è <span id="r_inf">INF</span></span><span class="res-val" id="res-inf">0</span></div>
        <div class="res-row"><span class="c-lan">‚öîÔ∏è <span id="r_lan">LAN</span></span><span class="res-val" id="res-lan">0</span></div>
        <div class="res-row"><span class="c-mar">üèπ <span id="r_tir">TIR</span></span><span class="res-val" id="res-mar">0</span></div>
      </div>
      <div id="val-box" class="val-box"></div>
    </div>

    <div class="footer-actions">
      <button class="btn btn-reset" onclick="resetForm()" id="btn_reset">REINICIAR</button>
      <button class="btn btn-calc" onclick="calculate()" id="btn_calc">CALCULAR</button>
    </div>

    <button class="epic-donate-btn" onclick="openModal()">
      üíé <span id="lnk_donate">APOYAR EL PROYECTO</span> üíé
    </button>
  </div>

  <div id="donateModal" class="modal-overlay" onclick="closeModalOnBg(event)">
    <div class="modal-content">
      <div class="d-title-radiant" id="d_title"></div>
      <div class="d-text-joy" id="d_text"></div>
      
      <div style="text-align:left;">
        <label style="font-size:0.7rem; font-weight:bold; color:#009ee3; letter-spacing:1px;">MERCADO PAGO (ALIAS)</label>
        <div class="copy-box" onclick="copyText('rapo.tela.curry.mp')">
          <span>rapo.tela.curry.mp</span>
          <span>üìã</span>
        </div>
        
        <label style="font-size:0.7rem; font-weight:bold; color:#003087; letter-spacing:1px;">PAYPAL</label>
        <a href="https://www.paypal.com/paypalme/marcosbogado245" target="_blank" class="pp-btn">
          IR A PAYPAL üöÄ
        </a>
      </div>

      <button class="close-modal-btn" onclick="closeModal()">CERRAR</button>
    </div>
  </div>

  <script>
    const i18n = {
      es: {
        t_conf:"DATOS DE BATALLA", l_cap:"CAPACIDAD", l_mar:"MARCHAS", t_strat:"CONF. TROPAS (%)",
        l_inf:"INFANTER√çA", l_lan:"LANCEROS", l_tir:"TIRADORES", t_inv:"INVENTARIO (OPCIONAL)",
        t_res:"RESULTADO PREDEFINIDO", btn_reset:"REINICIAR", btn_calc:"CALCULAR ESTRATEGIA",
        lnk_donate:"APOYAR EL PROYECTO", req:"Req", ok:"Suficiente", miss:"Falta",
        err1:"Ingresa capacidad v√°lida", err2:"Suma debe ser 100%",
        // MENSAJES RADIANTES
        d_title:"¬°GRACIAS, LEYENDA ETERNA! ‚ú®üíé",
        d_text:"Tu apoyo no es solo combustible; es la chispa divina que enciende esta forja. ¬°Nos llena de una alegr√≠a inmensa y un honor absoluto contar contigo! ¬°Eres magn√≠fico! üöÄüî•"
      },
      en: {
        t_conf:"BATTLE DATA", l_cap:"CAPACITY", l_mar:"QUEUES", t_strat:"TROOP CONFIG (%)",
        l_inf:"INFANTRY", l_lan:"LANCERS", l_tir:"MARKSMEN", t_inv:"INVENTORY (OPTIONAL)",
        t_res:"PRESET RESULT", btn_reset:"RESET", btn_calc:"CALCULATE STRATEGY",
        lnk_donate:"SUPPORT THE PROJECT", req:"Req", ok:"Enough", miss:"Missing",
        err1:"Enter valid capacity", err2:"Sum must be 100%",
        d_title:"THANK YOU, ETERNAL LEGEND! ‚ú®üíé",
        d_text:"Your support isn't just fuel; it's the divine spark that ignites this forge. We are filled with immense joy and absolute honor to have you! You are magnificent! üöÄüî•"
      },
      it: {
        t_conf:"DATI BATTAGLIA", l_cap:"CAPACIT√Ä", l_mar:"CODE", t_strat:"CONF. TRUPPE (%)",
        l_inf:"FANTERIA", l_lan:"LANCIERI", l_tir:"TIRATORI", t_inv:"INVENTARIO (OPZIONALE)",
        t_res:"RISULTATO PREIMPOSTATO", btn_reset:"REIMPOSTA", btn_calc:"CALCOLA STRATEGIA",
        lnk_donate:"SOSTIENI IL PROGETTO", req:"Rich", ok:"Sufficiente", miss:"Manca",
        err1:"Capacit√† non valida", err2:"Somma deve essere 100%",
        d_title:"GRAZIE, LEGGENDA ETERNA! ‚ú®üíé",
        d_text:"Il tuo supporto non √® solo carburante; √® la scintilla divina che accende questa forgia. Siamo pieni di gioia immensa e onore assoluto di averti! Sei magnifico! üöÄüî•"
      },
      pt: {
        t_conf:"DADOS DE BATALHA", l_cap:"CAPACIDADE", l_mar:"FILAS", t_strat:"CONF. TROPAS (%)",
        l_inf:"INFANTARIA", l_lan:"LANCEIROS", l_tir:"ATIRADORES", t_inv:"INVENT√ÅRIO (OPCIONAL)",
        t_res:"RESULTADO PREDEFINIDO", btn_reset:"REINICIAR", btn_calc:"CALCULAR ESTRAT√âGIA",
        lnk_donate:"APOIAR O PROJETO", req:"Nec", ok:"Suficiente", miss:"Falta",
        err1:"Capacidade inv√°lida", err2:"Soma deve ser 100%",
        d_title:"OBRIGADO, LENDA ETERNA! ‚ú®üíé",
        d_text:"Seu apoio n√£o √© apenas combust√≠vel; √© a centelha divina que acende esta forja. Estamos cheios de imensa alegria e honra absoluta em ter voc√™! Voc√™ √© magn√≠fico! üöÄüî•"
      }
    };

    let curLang = 'es';
    function setLang(lang, el) {
      curLang = lang;
      document.querySelectorAll('.flag-icon').forEach(f => f.classList.remove('active'));
      el.classList.add('active');
      const t = i18n[lang];
      safeTxt('t_conf', t.t_conf); safeTxt('l_cap', t.l_cap); safeTxt('l_mar', t.l_mar);
      safeTxt('t_strat', t.t_strat); safeTxt('l_inf', t.l_inf); safeTxt('l_lan', t.l_lan); safeTxt('l_tir', t.l_tir);
      safeTxt('t_inv', t.t_inv); safeTxt('t_res', t.t_res);
      safeTxt('r_inf', t.l_inf.substr(0,3)); safeTxt('r_lan', t.l_lan.substr(0,3)); safeTxt('r_tir', t.l_tir.substr(0,3));
      safeTxt('btn_reset', t.btn_reset); safeTxt('btn_calc', t.btn_calc); safeTxt('lnk_donate', t.lnk_donate);
      safeTxt('d_title', t.d_title); safeTxt('d_text', t.d_text);
    }
    function safeTxt(id, txt) { const el = document.getElementById(id); if(el) el.innerText = txt; }

    function calculate() {
      try {
        const t = i18n[curLang];
        const cap = parseInt(document.getElementById('capacity').value) || 0;
        const marches = parseInt(document.getElementById('march-count').value) || 1;
        const pInf = parseFloat(document.getElementById('pct-inf').value) || 0;
        const pLan = parseFloat(document.getElementById('pct-lan').value) || 0;
        const pMar = parseFloat(document.getElementById('pct-mar').value) || 0;
        if (cap <= 0) { alert(t.err1); return; }
        if (Math.abs((pInf + pLan + pMar) - 100) > 0.5) { alert(t.err2); return; }

        const uInf = Math.floor(cap * (pInf / 100));
        const uLan = Math.floor(cap * (pLan / 100));
        const uMar = cap - uInf - uLan;

        document.getElementById('res-inf').innerText = uInf.toLocaleString();
        document.getElementById('res-lan').innerText = uLan.toLocaleString();
        document.getElementById('res-mar').innerText = uMar.toLocaleString();

        const sInf = (document.getElementById('stock-inf').value === "") ? Infinity : parseInt(document.getElementById('stock-inf').value);
        const sLan = (document.getElementById('stock-lan').value === "") ? Infinity : parseInt(document.getElementById('stock-lan').value);
        const sMar = (document.getElementById('stock-mar').value === "") ? Infinity : parseInt(document.getElementById('stock-mar').value);

        let html = "";
        html += renderCheck(t.l_inf, uInf * marches, sInf, t);
        html += renderCheck(t.l_lan, uLan * marches, sLan, t);
        html += renderCheck(t.l_tir, uMar * marches, sMar, t);
        document.getElementById('val-box').innerHTML = html;
        document.getElementById('results').style.display = 'block';
        
        // Ejecuci√≥n segura de Google Script
        if(typeof google !== 'undefined' && google.script) { 
          google.script.run.withFailureHandler(function(){}).logUsage(cap, march